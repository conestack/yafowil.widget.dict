var yafowil_dict=function(t,e){"use strict";class i{static initialize(t){e("table.dictwidget",t).each((function(){let t=e(this);void 0!==window.yafowil_array&&window.yafowil_array.inside_template(t)||new i(t)}))}constructor(t){t.data("yafowil-dict",this),this.elem=t;let i=e("> thead .dict_actions",t),a=this.add_first_handle.bind(this);e("a.dict_row_add",i).off().on("click",a),this.bind_actions()}bind_actions(){let t=e("> tbody > tr > td.actions .dict_actions",this.elem),i=this.add_handle.bind(this),a=this.remove_handle.bind(this),r=this.up_handle.bind(this),s=this.down_handle.bind(this);this.mark_disabled(t),e("a.dict_row_add",t).off().on("click",i),e("a.dict_row_remove",t).off().on("click",a),e("a.dict_row_up",t).off().on("click",r),e("a.dict_row_down",t).off().on("click",s)}mark_disabled(t){e("a.dict_row_up",t).removeClass("dict_row_up_disabled").first().addClass("dict_row_up_disabled"),e("a.dict_row_down",t).removeClass("dict_row_down_disabled").last().addClass("dict_row_down_disabled")}row_class(t,e){for(let t of this.elem.attr("class").split(" "))if(t.substring(0,e.length)==e)return t.substring(e.length+1,t.length);return""}create_row(t){let e="";return e+="<tr>",e+='<td class="key">',e+='<input type="text" class="'+this.row_class(t,"key")+'" value="" />',e+="</td>",e+='<td class="value">',e+='<input type="text" class="'+this.row_class(t,"value")+'" value="" />',e+="</td>",e+='<td class="actions">',e+='<div class="dict_actions">',e+='<a class="dict_row_add" href="#">',e+='<span class="icon-plus-sign"> </span>',e+="</a>",e+='<a class="dict_row_remove" href="#">',e+='<span class="icon-minus-sign"> </span>',e+="</a>",e+='<a class="dict_row_up" href="#">',e+='<span class="icon-circle-arrow-up"> </span>',e+="</a>",e+='<a class="dict_row_down" href="#">',e+='<span class="icon-circle-arrow-down"> </span>',e+="</a>",e+="</div>",e+="</td>",e+="</tr>",e}get_row(t){return e(t).parent().parent().parent()}get base_name(){let t=this.elem.attr("id");return t.substring(11,t.length)}reset_indices(t){var i=0,a=this.base_name,r=a.replace(/\./g,"-");e("tr",t).each((function(){let t=e(this),s=e("td.key input",t),n=r+i+"-key",d=a+i+".key";s.attr("id",n).attr("name",d);let o=e("td.value input",t),l=r+i+"-value",c=a+i+".value";o.attr("id",l).attr("name",c),i++})),this.bind_actions()}add_first_handle(t){t.preventDefault();let i=this.create_row(t.currentTarget),a=e("> tbody",this.elem);a.prepend(i),this.reset_indices(a)}add_handle(t){t.preventDefault();let e=t.currentTarget,i=this.get_row(e),a=this.create_row(e),r=i.parent();i.after(a),this.reset_indices(r)}remove_handle(t){t.preventDefault();let e=this.get_row(t.currentTarget),i=e.parent();e.remove(),this.reset_indices(i)}up_handle(t){t.preventDefault();let e=this.get_row(t.currentTarget);e.insertBefore(e.prev()),this.reset_indices(e.parent())}down_handle(t){t.preventDefault();let e=this.get_row(t.currentTarget);e.insertAfter(e.next()),this.reset_indices(e.parent())}}function a(t,e){i.initialize(e)}function r(){void 0!==window.yafowil_array?window.yafowil_array.on_array_event("on_add",a):void 0!==yafowil.array&&e.extend(yafowil.array.hooks.add,{dictwidget_binder:i.initialize})}return e((function(){void 0!==window.ts?ts.ajax.register(i.initialize,!0):void 0!==window.bdajax?bdajax.register(i.initialize,!0):i.initialize(),r()})),t.DictWidget=i,t.register_array_subscribers=r,Object.defineProperty(t,"__esModule",{value:!0}),window.yafowil=window.yafowil||{},window.yafowil.dict=t,t}({},jQuery);
